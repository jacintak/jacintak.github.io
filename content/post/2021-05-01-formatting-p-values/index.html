---
title: Formatting P values
author: admin
date: '2021-05-01'
slug: []
categories: [code]
tags: [R stats, code]
subtitle: 'For printing ANOVA or regression coefficients tables'
summary: 'An R function for formatting really small P values to print ANOVA or regression coefficient tables'
authors: []
lastmod: '2021-05-01'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<p>This <a href="https://www.r-bloggers.com/2016/03/correctly-reporting-p-values-in-summary-tables-reported-with-xtable/">post</a> on R bloggers describes a handy function for formatting really small P values in ANOVA tables (more than 3 decimal places) with <span class="math inline">\(&lt;0.001\)</span>. I find this easier to read when I need to present a formatted table, e.g. in teaching.</p>
<p>The original function doesn’t cover all ways of creating ANOVA tables in <code>R</code> so I have extended the function to cover more cases. The <code>fixp</code> function below will work for ANOVA tables (<code>x</code>) generated by <code>anova(lm(...))</code> and <code>summary(aov(lm(...)))</code>, as well as the model coefficients table generated by <code>coef(summary(lm(...)))</code>.</p>
<div id="a-function-to-format-p-values" class="section level2">
<h2>A function to format P values</h2>
<pre><code>fixp &lt;- function(x, dig=3){

# Convert to a data frame
  if(is.data.frame(x) | is.matrix(x)){
  x &lt;- as.data.frame(x)
  } else {
  x &lt;- as.data.frame(x[[1]])
  }

# Check column order  
  if(substr(names(x)[ncol(x)],1,2) != &quot;Pr&quot;){
    warning(&quot;The name of the last column didn&#39;t start with Pr. This may indicate that p-values weren&#39;t in the last row, and thus, that this function is inappropriate.&quot;)
    }
    
# Round P values to &quot;dig&quot; decimal places, default 3     
  x[,ncol(x)] &lt;- round(x[,ncol(x)], dig)

#  
  for(i in 1:nrow(x)){
    if(x[i,ncol(x)] == 0 &amp; !is.na(x[i,ncol(x)])){
      x[i,ncol(x)] &lt;- paste0(&quot;&lt;0.&quot;, paste0(rep(0,dig-1), collapse=&quot;&quot;), &quot;1&quot;)
      }
  }
  x
}</code></pre>
<p>The main modification to the original function is to expand the conversion of <code>x</code> to a data frame to accept lists and matrices. <code>summary(aov(lm(...)))</code> creates an object with class <code>summary.aov</code> which is a list and the coefficients table is a matrix. Although <code>anova(lm(...))</code> creates a data frame that will work with the function without a fatal error, the function <code>anova</code> has its own way of “pretty” printing [to quote the help file] which is not compatible with the character vector in the P value column and thus will show a P value of 1. So forcing to a data frame is necessary. A minor modification is to ignore the NAs in the Residual row created by the data frame which would otherwise give an error.</p>
<p>The three decimal places for P values is coded into the function by default and can be changed by the <code>dig</code> option. For example, <code>dig = 1</code> will give you <span class="math inline">\(&lt;0.1\)</span>. You can then call your ANOVA table and the <code>fixp</code> function through <code>knitr::kable()</code> or your favourite HTML/LaTeX table formatter. e.g. <code>kable(fixp(anova(lm(...))), digits = ...)</code>. If you don’t want to print NAs, it’s probably better to use the options in your chosen formatting function - e.g. the <code>knitr.kable.NA</code> option in <a href="https://bookdown.org/yihui/rmarkdown-cookbook/kable.html"><code>kable</code></a>.</p>
</div>
